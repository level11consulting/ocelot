- name: Install Ocelot's go dependencies (may take a moment...)
  retries: 2
  shell: |
    export GOPATH=/home/vagrant/go
    export GO111MODULE=on
    export PATH=$PATH:/snap/bin:$GOPATH/bin
    go mod tidy
  args:
    chdir: ./go/src/github.com/level11consulting/ocelot
    executable: /bin/bash

- name: Run code generation
  shell: |
    export GOPATH=/home/vagrant/go
    export PATH=$PATH:/snap/bin:$GOPATH/bin
    make proto
  args:
    chdir: /home/vagrant/go/src/github.com/level11consulting/ocelot

- name: Run local compile, and install locally
  shell: |
    export GOPATH=/home/vagrant/go
    export GO111MODULE=on
    export PATH=$PATH:/snap/bin:$GOPATH/bin
    make local
  args:
    chdir: /home/vagrant/go/src/github.com/level11consulting/ocelot
